<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Immuno Chat</title>
    <link rel="shortcut icon" type="image/x-icon" href="Logo.ico" />
    <script src="/socket.io/socket.io.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #6dd5ed, #2193b0);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
      }
      h1 {
        color: #333;
        margin-bottom: 5px;
      }
      #username-display {
        color: #555;
        font-weight: bold;
      }
      #chat {
        width: 80%;
        height: 50%;
        border: 1px solid #ccc;
        border-radius: 5px;
        background: linear-gradient(145deg, #ff7e5f, #feb47b);
        overflow-y: auto;
        padding: 10px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
        margin-bottom: 20px;
      }
      .chatmessage {
        margin-bottom: 10px;
      }
      #textbox {
        width: 70%;
        padding: 10px;
        font-size: 16px;
        margin-bottom: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
      }
      #send-btn {
        padding: 10px 15px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
      }
      #send-btn:hover {
        background-color: #218838;
      }
    </style>
  </head>
  <body>
    <h1>Immuno Chat</h1>
    <div id="username-display">Username: <strong id="username"></strong></div>
    <div id="chat"></div>
    <input type="text" id="textbox" placeholder="Type a message..." />
    <button id="send-btn">Send</button>

    <script>
      // Retrieve the username from localStorage
      let username = localStorage.getItem("username");

      // If no username exists in localStorage, prompt the user
      if (!username) {
        username = prompt("Enter Username");
        while (!username || username.trim().length < 3 || username.trim().length > 20) {
          username = prompt("Enter a valid username (3-20 characters):");
        }
        username = username.trim();
        localStorage.setItem("username", username); // Save username to localStorage
      }

      // Display the username in the UI
      document.getElementById("username").textContent = username;

      // Initialize socket.io
      const socket = io();
      socket.emit("setUsername", username);

      // Handle message submission
      document.getElementById("send-btn").onclick = function () {
        const message = document.getElementById("textbox").value;
        if (message.trim() !== "") {
          socket.emit("sendMessage", message);
          document.getElementById("textbox").value = ""; // Clear input
        }
      };

      // Listen for incoming messages
      socket.on("receiveMessage", function (data) {
        const chat = document.getElementById("chat");
        const messageElement = document.createElement("div");
        messageElement.className = "chatmessage";
        messageElement.textContent = `${data.username}: ${data.message}`;
        chat.appendChild(messageElement);
        chat.scrollTop = chat.scrollHeight; // Auto-scroll to latest message
      });
    </script>
  </body>
</html>
